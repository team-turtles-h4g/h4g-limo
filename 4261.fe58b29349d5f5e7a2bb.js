(self.webpackChunkh4g_limo=self.webpackChunkh4g_limo||[]).push([[4261],{90495:(e,t,r)=>{"use strict";r.d(t,{g:()=>s});const s={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},33499:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var s=r(16304),a=r(8651),u=(r(42851),r(4706)),n=r(93668),o=r(20614),i=r(2747),l=r(12131),d=r(5902),c=r(45581),p=r(54704),y=r(27616),h=r(98154),m=r(57319),f=r(46942),R=(r(47648),r(18419),r(8680)),F=r(95046),g=r(60337),b=r(33569),_=r(92093),q=r(26092),v=r(89925),I=r(2379);const O=new d.Xn({originalAndCurrentFeatures:"original-and-current-features",none:"none"});function S(){return(S=(0,s.Z)(function*(e){return"string"==typeof e?(0,m.sJ)(e)||{data:e}:new Promise((t,r)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>t((0,m.sJ)(s.result)),s.onerror=e=>r(e)})})).apply(this,arguments)}const E=new Set(["Feature Layer","Table"]);let T=class extends c.Z{constructor(){var e;super(...arguments),e=this,this.type="feature-layer",this.refresh=(0,h.Ds)((0,s.Z)(function*(){var t,r;yield e.load();const s=null==(t=e.sourceJSON.editingInfo)?void 0:t.lastEditDate;if(null==s)return{hasUpdates:!0,updates:{}};try{yield e._fetchService(null)}catch{return{hasUpdates:!0,updates:{}}}const a=s!==(null==(r=e.sourceJSON.editingInfo)?void 0:r.lastEditDate);return{hasUpdates:a,updates:a?{editingInfo:e.sourceJSON.editingInfo,extent:e.sourceJSON.extent}:null}}))}load(e){const t=(0,p.pC)(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(this.layer.sourceJSON,t)),Promise.resolve(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:e}},parsedUrl:t,dynamicDataSource:r,infoFor3D:s,gdbVersion:a,spatialReference:u,fieldsIndex:n}=this.layer,o=(0,l.Z)("featurelayer-pbf")&&e&&(0,p.Wi)(s)?"pbf":"json";return new v.Z({url:t.path,format:o,fieldsIndex:n,infoFor3D:s,dynamicDataSource:r,gdbVersion:a,sourceSpatialReference:u})}addAttachment(e,t){var r=this;return(0,s.Z)(function*(){yield r.load();const s=e.attributes[r.layer.objectIdField],a=r.layer.parsedUrl.path+"/"+s+"/addAttachment",u=r._getLayerRequestOptions(),o=r._getFormDataForAttachment(t,u.query);try{const e=yield(0,n.default)(a,{body:o});return r._createFeatureEditResult(e.data.addAttachmentResult)}catch(i){throw r._createAttachmentErrorResult(s,i)}})()}updateAttachment(e,t,r){var a=this;return(0,s.Z)(function*(){yield a.load();const s=e.attributes[a.layer.objectIdField],u=a.layer.parsedUrl.path+"/"+s+"/updateAttachment",o=a._getLayerRequestOptions({query:{attachmentId:t}}),i=a._getFormDataForAttachment(r,o.query);try{const e=yield(0,n.default)(u,{body:i});return a._createFeatureEditResult(e.data.updateAttachmentResult)}catch(l){throw a._createAttachmentErrorResult(s,l)}})()}applyEdits(e,t){var r=this;return(0,s.Z)(function*(){yield r.load();const s=e.addFeatures.map(r._serializeFeature,r),a=e.updateFeatures.map(r._serializeFeature,r),u=r._getFeatureIds(e.deleteFeatures,null==t?void 0:t.globalIdUsed);(0,q.P)(s,a,r.layer.spatialReference);const o=[],i=[],l=[...e.deleteAttachments];for(const t of e.addAttachments)o.push(yield r._serializeAttachment(t));for(const t of e.updateAttachments)i.push(yield r._serializeAttachment(t));const d=o.length||i.length||l.length?{adds:o,updates:i,deletes:l}:null,c={gdbVersion:(null==t?void 0:t.gdbVersion)||r.layer.gdbVersion,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:null==t?void 0:t.globalIdUsed,returnEditMoment:null==t?void 0:t.returnEditMoment,usePreviousEditMoment:null==t?void 0:t.usePreviousEditMoment,sessionId:null==t?void 0:t.sessionId};null!=t&&t.returnServiceEditsOption?(c.edits=JSON.stringify([{id:r.layer.layerId,adds:s,updates:a,deletes:u,attachments:d}]),c.returnServiceEditsOption=O.toJSON(null==t?void 0:t.returnServiceEditsOption),c.returnServiceEditsInSourceSR=null==t?void 0:t.returnServiceEditsInSourceSR):(c.adds=s.length?JSON.stringify(s):null,c.updates=a.length?JSON.stringify(a):null,c.deletes=u.length?null!=t&&t.globalIdUsed?JSON.stringify(u):u.join(","):null,c.attachments=d&&JSON.stringify(d));const p=r._getLayerRequestOptions({method:"post",query:c}),y=null!=t&&t.returnServiceEditsOption?r.layer.url:r.layer.parsedUrl.path,h=yield(0,n.default)(y+"/applyEdits",p);return r._createEditsResult(h)})()}deleteAttachments(e,t){var r=this;return(0,s.Z)(function*(){yield r.load();const s=e.attributes[r.layer.objectIdField],a=r.layer.parsedUrl.path+"/"+s+"/deleteAttachments";try{return(yield(0,n.default)(a,r._getLayerRequestOptions({query:{attachmentIds:t.join(",")},method:"post"}))).data.deleteAttachmentResults.map(r._createFeatureEditResult)}catch(u){throw r._createAttachmentErrorResult(s,u)}})()}fetchRecomputedExtents(e={}){var t=this;return this.load({signal:e.signal}).then((0,s.Z)(function*(){const r=t._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:s,url:a}=t.layer,{data:u}=yield(0,n.default)(`${a}/${s}`,r),{id:i,extent:l,fullExtent:d,timeExtent:c}=u,p=l||d;return{id:i,fullExtent:p&&F.Z.fromJSON(p),timeExtent:c&&o.Z.fromJSON({start:c[0],end:c[1]})}}))}queryAttachments(e,t={}){var r=this;return(0,s.Z)(function*(){const{parsedUrl:s}=r.layer,a=s.path;yield r.load();const u=r._getLayerRequestOptions(t);if(!r.layer.get("capabilities.operations.supportsQueryAttachments")){const{objectIds:t}=e,r=[];for(const e of t)r.push((0,n.default)(a+"/"+e+"/attachments",u));return Promise.all(r).then(e=>t.map((t,r)=>({parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}))).then(e=>(0,_.O)(e,a))}return r.queryTask.executeAttachmentQuery(e,u)})()}queryFeatures(e,t){var r=this;return(0,s.Z)(function*(){return yield r.load(),r.queryTask.execute(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryFeaturesJSON(e,t){var r=this;return(0,s.Z)(function*(){return yield r.load(),r.queryTask.executeJSON(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryObjectIds(e,t){var r=this;return(0,s.Z)(function*(){return yield r.load(),r.queryTask.executeForIds(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryFeatureCount(e,t){var r=this;return(0,s.Z)(function*(){return yield r.load(),r.queryTask.executeForCount(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryExtent(e,t){var r=this;return(0,s.Z)(function*(){return yield r.load(),r.queryTask.executeForExtent(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryRelatedFeatures(e,t){var r=this;return(0,s.Z)(function*(){return yield r.load(),r.queryTask.executeRelationshipQuery(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryRelatedFeaturesCount(e,t){var r=this;return(0,s.Z)(function*(){return yield r.load(),r.queryTask.executeRelationshipQueryForCount(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryTopFeatures(e,t){var r=this;return(0,s.Z)(function*(){return yield r.load(),r.queryTask.executeTopFeaturesQuery(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryTopObjectIds(e,t){var r=this;return(0,s.Z)(function*(){return yield r.load(),r.queryTask.executeForTopIds(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryTopExtents(e,t){var r=this;return(0,s.Z)(function*(){return yield r.load(),r.queryTask.executeForTopExtents(e,{...t,query:r._createRequestQueryOptions(t)})})()}queryTopCount(e,t){var r=this;return(0,s.Z)(function*(){return yield r.load(),r.queryTask.executeForTopCount(e,{...t,query:r._createRequestQueryOptions(t)})})()}_createRequestQueryOptions(e){const t={...this.layer.customParameters,token:this.layer.apiKey,...null==e?void 0:e.query};return this.layer.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t}_fetchService(e,t){var r=this;return(0,s.Z)(function*(){if(!e){const{data:s}=yield(0,n.default)(r.layer.parsedUrl.path,r._getLayerRequestOptions({query:(0,l.Z)("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:t}));e=s}r.sourceJSON=r._patchServiceJSON(e);const s=e.type;if(!E.has(s))throw new i.Z("feature-layer-source:unsupported-type",`Source type "${s}" is not supported`)})()}_patchServiceJSON(e){var t;if("Table"!==e.type&&e.geometryType&&(null==e||null==(t=e.drawingInfo)||!t.renderer)&&!e.defaultSymbol){const t=(0,b.bU)(e.geometryType).renderer;(0,y.RB)("drawingInfo.renderer",t,e)}return"esriGeometryMultiPatch"===e.geometryType&&e.infoFor3D&&(e.geometryType="mesh"),e}_serializeFeature(e){const{geometry:t,attributes:r}=e;return(0,p.Wi)(t)?{attributes:r}:"mesh"===t.type||"extent"===t.type?null:{geometry:t.toJSON(),attributes:r}}_serializeAttachment(e){var t=this;return(0,s.Z)(function*(){const{feature:r,attachment:s}=e,{globalId:a,name:u,contentType:n,data:o,uploadId:i}=s,l={globalId:a,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(r&&(l.parentGlobalId="attributes"in r?r.attributes&&r.attributes[t.layer.globalIdField]:r.globalId),i)l.uploadId=i;else if(o){const e=yield function(e){return S.apply(this,arguments)}(o);l.contentType=e.mediaType,l.data=e.data,o instanceof File&&(l.name=o.name)}return u&&(l.name=u),n&&(l.contentType=n),l})()}_getFeatureIds(e,t){const r=e[0];return r?this._canUseGlobalIds(t,e)?this._getGlobalIdsFromFeatureIdentifier(e):"objectId"in r?this._getObjectIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const t=this.layer.objectIdField;return e.map(e=>e.attributes&&e.attributes[t])}_canUseGlobalIds(e,t){return e&&"globalId"in t[0]}_getObjectIdsFromFeatureIdentifier(e){return e.map(e=>e.objectId)}_getGlobalIdsFromFeatureIdentifier(e){return e.map(e=>e.globalId)}_createEditsResult(e){var t;const r=e.data,{layerId:s}=this.layer,a=[];let u=null;if(Array.isArray(r))for(const i of r)a.push({id:i.id,editedFeatures:i.editedFeatures}),i.id===s&&(u={addResults:i.addResults,updateResults:i.updateResults,deleteResults:i.deleteResults,attachments:i.attachments,editMoment:i.editMoment});else u=r;const n=null==(t=u)?void 0:t.attachments,o={addFeatureResults:u.addResults?u.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:u.updateResults?u.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:u.deleteResults?u.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:n&&n.addResults?n.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:n&&n.updateResults?n.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:n&&n.deleteResults?n.deleteResults.map(this._createFeatureEditResult,this):[]};if(u.editMoment&&(o.editMoment=u.editMoment),a.length>0){o.editedFeatureResults=[];for(const e of a){const{adds:t,updates:r,deletes:s,spatialReference:a}=e.editedFeatures,u=a?new I.Z(a):null;o.editedFeatureResults.push({layerId:e.id,editedFeatures:{adds:(null==t?void 0:t.map(e=>this._createEditedFeature(e,u)))||[],updates:(null==r?void 0:r.map(e=>({original:this._createEditedFeature(e[0],u),current:this._createEditedFeature(e[1],u)})))||[],deletes:(null==s?void 0:s.map(e=>this._createEditedFeature(e,u)))||[],spatialReference:u}})}}return o}_createEditedFeature(e,t){return new u.Z({attributes:e.attributes,geometry:(0,g.im)({...e.geometry,spatialReference:t})})}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new i.Z("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_createAttachmentErrorResult(e,t){return{objectId:e,globalId:null,error:new i.Z("feature-layer-source:attachment-failure",t.details.messages&&t.details.messages[0]||t.message,{code:t.details.httpStatus||t.details.messageCode})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const s in t){const e=t[s];null!=e&&(r.set?r.set(s,e):r.append(s,e))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:r,dynamicDataSource:s}=this.layer;return{...e,query:{gdbVersion:r,layer:s?JSON.stringify({source:s}):void 0,...t.query,f:"json",...this._createRequestQueryOptions(e)},responseType:"json"}}};(0,a._)([(0,f.Cb)()],T.prototype,"type",void 0),(0,a._)([(0,f.Cb)({constructOnly:!0})],T.prototype,"layer",void 0),(0,a._)([(0,f.Cb)({readOnly:!0})],T.prototype,"queryTask",null),T=(0,a._)([(0,R.j)("esri.layers.graphics.sources.FeatureLayerSource")],T);var x=T}}]);