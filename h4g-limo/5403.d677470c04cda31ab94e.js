(self.webpackChunkh4g_limo=self.webpackChunkh4g_limo||[]).push([[5403],{37882:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var s=i(12131),r=i(63054),l=i(30071),a=i(14045),h=i(81916);const n=(e,t)=>e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col;class u extends l.Z{constructor(e){super(),this._tileInfoView=e}get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(n),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){const{state:t}=e,i=super.createRenderParams(e);return i.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,i.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),i}prepareRenderPasses(e){const t=super.prepareRenderPasses(e);return t.push(e.registerRenderPass({name:"stencil",brushes:[h.Z],drawPhase:r.jx.DEBUG|r.jx.MAP|r.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,s.Z)("esri-tiles-debug")&&t.push(e.registerRenderPass({name:"tileInfo",brushes:[a.Z],drawPhase:r.jx.DEBUG,target:()=>this.children})),t}getStencilTarget(){return this.children}updateTransforms(e){for(const t of this.children){const i=this._tileInfoView.getTileResolution(t.key);t.setTransform(e,i)}}setStencilReference(){let e=1;for(const t of this.children)t.stencilRef=e++}}},50877:(e,t,i)=>{"use strict";i.d(t,{I:()=>a});var s=i(93883),r=i(66863),l=i(55757);class a extends r.s{constructor(e,t,i,s,r,a=s,h=r){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new l.Z(e),this.x=t,this.y=i,this.width=s,this.height=r,this.rangeX=a,this.rangeY=h}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e,t){const i=t/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[l,a]=e.toScreenNoRotation([0,0],[this.x,this.y]);(0,s.s)(r,this.width/this.rangeX*i,0,0,0,this.height/this.rangeY*i,0,l,a,1),(0,s.m)(this.transforms.dvs,e.displayViewMat3,r)}}},43918:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>w});var s=i(16304),r=i(8651),l=i(43435),a=i(98154),h=i(46942),n=(i(12131),i(47648),i(18419),i(8680)),u=i(33110),o=i(67692),c=i(60573),d=i(59269),f=i(82998),p=i(93729),y=i(72445);const _=[102113,102100,3857,3785,900913];let g=class extends((0,y.y)((0,u.Y)((0,o.y)(p.Z)))){constructor(){super(...arguments),this._handles=new l.Z,this._tileStrategy=null,this._fetchQueue=null,this._tileRequests=new Map,this.layer=null}get tileMatrixSet(){if(this.layer.activeLayer.tileMatrixSetId)return this.layer.activeLayer.tileMatrixSet;const e=this._getTileMatrixSetBySpatialReference(this.layer.activeLayer);return e?(this.layer.activeLayer.tileMatrixSetId=e.id,e):null}hitTest(){return null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this.notifyChange("updating")}attach(){if(!this.tileMatrixSet)return;const{tileInfo:e}=this.tileMatrixSet;this._tileInfoView=new c.Z(e),this._fetchQueue=new d.Z({tileInfoView:this._tileInfoView,process:e=>this.fetchTile(e)}),this._tileStrategy=new f.Z({cachePolicy:"keep",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),this._handles.add(this.watch(["layer.activeLayer.styleId","tileMatrixSet"],()=>this._refresh())),super.attach()}detach(){super.detach(),this._handles.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}doRefresh(){var e=this;return(0,s.Z)(function*(){e.updateRequested||e.suspended||e._refresh()})()}isUpdating(){return this._fetchQueue.length>0}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;[i.x,i.y]=this._tileInfoView.getTileCoords([0,0],t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._tileInfoView.getTileCoords(i,t.key);const s={id:e.id,fulfilled:!1,promise:this._fetchQueue.push(t.key).then(e=>{t.bitmap.source=e,t.once("attach",()=>this.requestUpdate()),this._bitmapView.addChild(t)}).catch(e=>{(0,a.D_)(e)||(t.bitmap.source=null,t.once("attach",()=>this.requestUpdate()),this._bitmapView.addChild(t))})};return s.promise.finally(()=>s.fulfilled=!0),this._tileRequests.set(t,s),this.requestUpdate(),t}releaseTile(e){const t=this._tileRequests.get(e);t.fulfilled||this._fetchQueue.abort(t.id),this._tileRequests.delete(e),this._bitmapView.removeChild(e),e.once("detach",()=>e.destroy()),this.requestUpdate()}fetchTile(e){var t=this;return(0,s.Z)(function*(){return t.layer.fetchTile(e.level,e.row,e.col)})()}canResume(){const e=super.canResume();return e?null!==this.tileMatrixSet:e}_refresh(){this._fetchQueue.reset(),this._tileStrategy.tiles.forEach(e=>{if(!e.bitmap.source)return;const t={id:e.key.id,fulfilled:!1,promise:this._fetchQueue.push(e.key).then(t=>{e.bitmap.source=t}).catch(t=>{(0,a.D_)(t)||(e.bitmap.source=null)}).finally(()=>{e.requestRender(),this.notifyChange("updating"),t.fulfilled=!0})};this._tileRequests.set(e,t)}),this.notifyChange("updating")}_getTileMatrixSetBySpatialReference(e){const t=this.view.spatialReference;if(!e.tileMatrixSets)return null;let i=e.tileMatrixSets.find(e=>e.tileInfo.spatialReference.wkid===t.wkid);return!i&&t.isWebMercator&&(i=e.tileMatrixSets.find(e=>_.indexOf(e.tileInfo.spatialReference.wkid)>-1)),i}};(0,r._)([(0,h.Cb)()],g.prototype,"suspended",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],g.prototype,"tileMatrixSet",null),g=(0,r._)([(0,n.j)("esri.views.2d.layers.WMTSLayerView2D")],g);var w=g},72445:(e,t,i)=>{"use strict";i.d(t,{y:()=>u});var s=i(8651),r=i(18419),l=i(98154),a=i(72147),h=i(46942),n=(i(12131),i(47648),i(8680));const u=e=>{let t=class extends e{initialize(){this.handles.add((0,a.on)(this,"layer","refresh",()=>{this.doRefresh().catch(e=>{(0,l.D_)(e)||r.Z.getLogger(this.declaredClass).error(e)})}),"RefreshableLayerView")}};return(0,s._)([(0,h.Cb)()],t.prototype,"layer",void 0),t=(0,s._)([(0,n.j)("esri.layers.mixins.RefreshableLayerView")],t),t}}}]);