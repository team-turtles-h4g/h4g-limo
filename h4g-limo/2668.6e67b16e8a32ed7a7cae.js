(self.webpackChunkh4g_limo=self.webpackChunkh4g_limo||[]).push([[2668],{78386:(e,t,i)=>{"use strict";function r(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function s(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){let t=0,i=0;for(let r=0;r<e.length;r++){const s=e[r].size;"number"==typeof s&&(t+=s,i++)}return t/i}(e.stops):t}function n(e,t){if(!t)return e;const i=t.filter(e=>"size"===e.type).map(t=>{const{maxSize:i,minSize:r}=t;return(s(i,e)+s(r,e))/2});let r=0;const n=i.length;if(0===n)return e;for(let s=0;s<n;s++)r+=i[s];const a=Math.floor(r/n);return Math.max(a,e)}function a(e){const t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;const s="visualVariables"in t?n(i,t.visualVariables):i;if("simple"===t.type)return r(s,t.symbol);if("unique-value"===t.type){let e=s;return t.uniqueValueInfos.forEach(t=>{e=r(e,t.symbol)}),e}if("class-breaks"===t.type){let e=s;return t.classBreakInfos.forEach(t=>{e=r(e,t.symbol)}),e}return s}i.d(t,{k:()=>a})},37882:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var r=i(12131),s=i(63054),n=i(30071),a=i(14045),l=i(81916);const o=(e,t)=>e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col;class h extends n.Z{constructor(e){super(),this._tileInfoView=e}get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(o),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){const{state:t}=e,i=super.createRenderParams(e);return i.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,i.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),i}prepareRenderPasses(e){const t=super.prepareRenderPasses(e);return t.push(e.registerRenderPass({name:"stencil",brushes:[l.Z],drawPhase:s.jx.DEBUG|s.jx.MAP|s.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,r.Z)("esri-tiles-debug")&&t.push(e.registerRenderPass({name:"tileInfo",brushes:[a.Z],drawPhase:s.jx.DEBUG,target:()=>this.children})),t}getStencilTarget(){return this.children}updateTransforms(e){for(const t of this.children){const i=this._tileInfoView.getTileResolution(t.key);t.setTransform(e,i)}}setStencilReference(){let e=1;for(const t of this.children)t.stencilRef=e++}}},50877:(e,t,i)=>{"use strict";i.d(t,{I:()=>a});var r=i(93883),s=i(66863),n=i(55757);class a extends s.s{constructor(e,t,i,r,s,a=r,l=s){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new n.Z(e),this.x=t,this.y=i,this.width=r,this.height=s,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e,t){const i=t/(e.resolution*e.pixelRatio),s=this.transforms.tileMat3,[n,a]=e.toScreenNoRotation([0,0],[this.x,this.y]);(0,r.s)(s,this.width/this.rangeX*i,0,0,0,this.height/this.rangeY*i,0,n,a,1),(0,r.m)(this.transforms.dvs,e.displayViewMat3,s)}}},42149:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>T});var r=i(16304),s=i(8651),n=i(2747),a=i(18419),l=i(54704),o=i(98154),h=i(46942),u=(i(12131),i(47648),i(8680)),c=i(33110),f=i(67692),p=i(60573),y=i(55757),d=i(59269),m=i(82998),g=i(93729),w=i(72445),_=i(78386);const v=e=>{let t=class extends e{fetchPopupFeatures(e,t){var i=this;return(0,r.Z)(function*(){const{layer:s}=i;if(!e)return Promise.reject(new n.Z("tilelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:s}));if("tile"!==s.type)return Promise.reject(new n.Z("tilelayerview:fetchPopupFeatures","Layer type should be 'tile'",{type:s.type}));const a=i.get("view.scale"),h=s.allSublayers.toArray().filter(e=>e.popupTemplate&&e.popupEnabled&&e.visible&&(0===e.minScale||a<=e.minScale)&&(0===e.maxScale||a>=e.maxScale));return(0,o.as)(h.map(function(){var s=(0,r.Z)(function*(r){const s=r.createQuery(),n=(0,l.pC)(t)?t.event:null,a=(0,_.k)({renderer:r.renderer,event:n});return s.geometry=i.createFetchPopupFeaturesQueryGeometry(e,a),s.outFields=yield r.popupTemplate.getRequiredFields(),(yield r.queryFeatures(s)).features});return function(e){return s.apply(this,arguments)}}())).then(e=>[].concat(...e.map(e=>e.value).filter(Boolean)))})()}};return(0,s._)([(0,h.Cb)()],t.prototype,"layer",void 0),t=(0,s._)([(0,u.j)("esri.layers.mixins.TileLayerView")],t),t};var I=i(49455);const x=a.Z.getLogger("esri.views.2d.layers.TileLayerView2D"),b=[0,0];let R=class extends(v((0,w.y)((0,c.Y)((0,f.y)(g.Z))))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}initialize(){const e=this.layer.tileInfo,t=e&&e.spatialReference;let i;t||(i=new n.Z("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer})),t.equals(this.view.spatialReference)||(i=new n.Z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})),this.watch("resampling",()=>{this.doRefresh()}),i&&this.addResolvingPromise(Promise.reject(i))}get resampling(){return!("resampling"in this.layer)||!1!==this.layer.resampling}hitTest(){return null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this.notifyChange("updating")}attach(){const e="tileServers"in this.layer?this.layer.tileServers:null;this._tileInfoView=new p.Z(this.layer.tileInfo,this.layer.fullExtent),this._fetchQueue=new d.Z({tileInfoView:this._tileInfoView,concurrency:e&&10*e.length||10,process:(e,t)=>this.fetchTile(e,t)}),this._tileStrategy=new m.Z({cachePolicy:"keep",resampling:this.resampling,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),this.requestUpdate(),this.container.requestRender(),super.attach()}detach(){super.detach(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(e,t){return(0,I.K)(e,t,this.view)}doRefresh(){var e=this;return(0,r.Z)(function*(){e.updateRequested||e.suspended||(e._fetchQueue.reset(),e._tileStrategy.tiles.forEach(t=>e._enqueueTileFetch(t)),e.notifyChange("updating"))})()}isUpdating(){var e;return(null==(e=this._fetchQueue)?void 0:e.length)>0}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;return[i.x,i.y]=this._tileInfoView.getTileCoords(b,t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._enqueueTileFetch(t),this._bitmapView.addChild(t),this.requestUpdate(),t}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once("detach",()=>e.destroy()),this.requestUpdate()}fetchTile(e,t){var i=this;return(0,r.Z)(function*(){const r="tilemapCache"in i.layer?i.layer.tilemapCache:null,s=!(0,l.Wi)(t)&&t.signal;if(!r)try{return yield i._fetchImage(e,s)}catch(f){if(!(0,o.D_)(f)&&!i.resampling)return i._createBlankImage();throw f}const n=new y.Z(0,0,0,0);let a;try{if(yield r.fetchAvailabilityUpsample(e.level,e.row,e.col,n,{signal:s}),n.level!==e.level&&!i.resampling)return i._createBlankImage();a=yield i._fetchImage(n,s)}catch(f){if((0,o.D_)(f))throw f;a=yield i._fetchImage(e,s)}const{level:h,row:u,col:c}=n;return i.resampling&&h!==e.level?i._resampleImage(a,h,u,c,e.level,e.row,e.col):a})()}_enqueueTileFetch(e){var t=this;return(0,r.Z)(function*(){if(!t._fetchQueue.has(e.key.id)){try{const i=yield t._fetchQueue.push(e.key);e.bitmap.source=i,e.bitmap.width=t._tileInfoView.tileInfo.size[0],e.bitmap.height=t._tileInfoView.tileInfo.size[1],e.once("attach",()=>t.requestUpdate())}catch(i){(0,o.D_)(i)||x.error(i)}t.requestUpdate()}})()}_fetchImage(e,t){var i=this;return(0,r.Z)(function*(){return i.layer.fetchTile(e.level,e.row,e.col,{signal:t})})()}_resampleImage(e,t,i,r,s,n,a){const l=this._tileInfoView.tileInfo.size,o=this._tileInfoView.getTileResolution(t),h=this._tileInfoView.getTileResolution(s);let u=this._tileInfoView.getLODInfoAt(s);const c=u.getXForColumn(a),f=u.getYForRow(n);u=this._tileInfoView.getLODInfoAt(t);const p=u.getXForColumn(r),y=u.getYForRow(i),d=Math.round((c-p)/o),m=Math.round(-(f-y)/o),g=Math.round(l[0]*(h/o)),w=Math.round(l[1]*(h/o)),_=this._createBlankImage();return _.getContext("2d").drawImage(e,d,m,g,w,0,0,l[0],l[1]),_}_createBlankImage(){const e=this._tileInfoView.tileInfo.size,t=document.createElement("canvas");return[t.width,t.height]=e,t}};(0,s._)([(0,h.Cb)()],R.prototype,"resampling",null),R=(0,s._)([(0,u.j)("esri.views.2d.layers.TileLayerView2D")],R);var T=R},72445:(e,t,i)=>{"use strict";i.d(t,{y:()=>h});var r=i(8651),s=i(18419),n=i(98154),a=i(72147),l=i(46942),o=(i(12131),i(47648),i(8680));const h=e=>{let t=class extends e{initialize(){this.handles.add((0,a.on)(this,"layer","refresh",()=>{this.doRefresh().catch(e=>{(0,n.D_)(e)||s.Z.getLogger(this.declaredClass).error(e)})}),"RefreshableLayerView")}};return(0,r._)([(0,l.Cb)()],t.prototype,"layer",void 0),t=(0,r._)([(0,o.j)("esri.layers.mixins.RefreshableLayerView")],t),t}},49455:(e,t,i)=>{"use strict";i.d(t,{K:()=>a}),i(42851);var r=i(54704),s=i(43899),n=i(95046);function a(e,t,i,a=new n.Z){let l;if("2d"===i.type)l=t*i.resolution;else if("3d"===i.type){const n=i.overlayPixelSizeInMapUnits(e),a=i.basemapSpatialReference;l=(0,r.pC)(a)&&!a.equals(i.spatialReference)?(0,s.c9)(a)/(0,s.c9)(i.spatialReference):t*n}const o=e.x-l,h=e.y-l,u=e.x+l,c=e.y+l,{spatialReference:f}=i;return a.xmin=Math.min(o,u),a.ymin=Math.min(h,c),a.xmax=Math.max(o,u),a.ymax=Math.max(h,c),a.spatialReference=f,a}new n.Z}}]);