(self.webpackChunkh4g_limo=self.webpackChunkh4g_limo||[]).push([[6283],{97112:(e,t,r)=>{"use strict";r.d(t,{e:()=>o});var n,i,s,a={exports:{}};n=a,i=function(){function e(e,r,i){i=i||2;var s,a,o,u,v,c,h,d=r&&r.length,f=d?r[0]*i:e.length,x=t(e,0,f,i,!0),p=[];if(!x||x.next===x.prev)return p;if(d&&(x=l(e,r,x,i)),e.length>80*i){s=o=e[0],a=u=e[1];for(var y=i;y<f;y+=i)(v=e[y])<s&&(s=v),(c=e[y+1])<a&&(a=c),v>o&&(o=v),c>u&&(u=c);h=0!==(h=Math.max(o-s,u-a))?1/h:0}return n(x,p,i,s,a,h),p}function t(e,t,r,n,i){var s,a;if(i===E(e,t,r,n)>0)for(s=t;s<r;s+=n)a=M(s,e[s],e[s+1],a);else for(s=r-n;s>=t;s-=n)a=M(s,e[s],e[s+1],a);if(a&&S(a,a.next)){var o=a.next;T(a),a=o}return a}function r(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!S(n,n.next)&&0!==g(n.prev,n,n.next))n=n.next;else{var i=n.prev;if(T(n),(n=t=i)===n.next)break;r=!0}}while(r||n!==t);return t}function n(e,t,l,u,v,c,h){if(e){!h&&c&&d(e,u,v,c);for(var f,x,p=e;e.prev!==e.next;)if(f=e.prev,x=e.next,c?s(e,u,v,c):i(e))t.push(f.i/l),t.push(e.i/l),t.push(x.i/l),T(e),e=x.next,p=x.next;else if((e=x)===p){h?1===h?n(e=a(r(e),t,l),t,l,u,v,c,2):2===h&&o(e,t,l,u,v,c):n(r(e),t,l,u,v,c,1);break}}}function i(e){var t=e.prev,r=e,n=e.next;if(g(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(p(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function s(e,t,r,n){var i=e.prev,s=e,a=e.next;if(g(i,s,a)>=0)return!1;for(var o=i.x>s.x?i.x>a.x?i.x:a.x:s.x>a.x?s.x:a.x,l=i.y>s.y?i.y>a.y?i.y:a.y:s.y>a.y?s.y:a.y,u=f(i.x<s.x?i.x<a.x?i.x:a.x:s.x<a.x?s.x:a.x,i.y<s.y?i.y<a.y?i.y:a.y:s.y<a.y?s.y:a.y,t,r,n),v=f(o,l,t,r,n),c=e.prevZ,h=e.nextZ;c&&c.z>=u&&h&&h.z<=v;){if(c!==e.prev&&c!==e.next&&p(i.x,i.y,s.x,s.y,a.x,a.y,c.x,c.y)&&g(c.prev,c,c.next)>=0)return!1;if(c=c.prevZ,h!==e.prev&&h!==e.next&&p(i.x,i.y,s.x,s.y,a.x,a.y,h.x,h.y)&&g(h.prev,h,h.next)>=0)return!1;h=h.nextZ}for(;c&&c.z>=u;){if(c!==e.prev&&c!==e.next&&p(i.x,i.y,s.x,s.y,a.x,a.y,c.x,c.y)&&g(c.prev,c,c.next)>=0)return!1;c=c.prevZ}for(;h&&h.z<=v;){if(h!==e.prev&&h!==e.next&&p(i.x,i.y,s.x,s.y,a.x,a.y,h.x,h.y)&&g(h.prev,h,h.next)>=0)return!1;h=h.nextZ}return!0}function a(e,t,n){var i=e;do{var s=i.prev,a=i.next.next;!S(s,a)&&m(s,i,i.next,a)&&b(s,a)&&b(a,s)&&(t.push(s.i/n),t.push(i.i/n),t.push(a.i/n),T(i),T(i.next),i=e=a),i=i.next}while(i!==e);return r(i)}function o(e,t,i,s,a,o){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&y(l,u)){var v=L(l,u);return l=r(l,l.next),v=r(v,v.next),n(l,t,i,s,a,o),void n(v,t,i,s,a,o)}u=u.next}l=l.next}while(l!==e)}function l(e,n,i,s){var a,o,l,v=[];for(a=0,o=n.length;a<o;a++)(l=t(e,n[a]*s,a<o-1?n[a+1]*s:e.length,s,!1))===l.next&&(l.steiner=!0),v.push(x(l));for(v.sort(u),a=0;a<v.length;a++)i=r(i=c(v[a],i),i.next);return i}function u(e,t){return e.x-t.x}function v(e){if(e.next.prev===e)return e;let t=e;for(;;){const r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function c(e,t){var n=function(e,t){var r,n=t,i=e.x,s=e.y,a=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var o=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=i&&o>a){if(a=o,o===i){if(s===n.y)return n;if(s===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===a)return r;var l,u=r,v=r.x,c=r.y,d=1/0;n=r;do{i>=n.x&&n.x>=v&&i!==n.x&&p(s<c?i:a,s,v,c,s<c?a:i,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(i-n.x),b(n,e)&&(l<d||l===d&&(n.x>r.x||n.x===r.x&&h(r,n)))&&(r=n,d=l)),n=n.next}while(n!==u);return r}(e,t);if(!n)return t;var i=L(n,e),s=r(n,n.next);let a=v(i);return r(a,a.next),s=v(s),v(t===n?s:t)}function h(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function d(e,t,r,n){var i=e;do{if(null===i.z&&(i.z=f(i.x,i.y,t,r,n)),i.prev.next!==i||i.next.prev!==i)return i.prev.next=i,i.next.prev=i,d(e,t,r,n);i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,s,a,o,l,u=1;do{for(r=e,e=null,s=null,a=0;r;){for(a++,n=r,o=0,t=0;t<u&&(o++,n=n.nextZ);t++);for(l=u;o>0||l>0&&n;)0!==o&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,o--):(i=n,n=n.nextZ,l--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;r=n}s.nextZ=null,u*=2}while(a>1)}(i)}function f(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function x(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function p(e,t,r,n,i,s,a,o){return(i-a)*(t-o)-(e-a)*(s-o)>=0&&(e-a)*(n-o)-(r-a)*(t-o)>=0&&(r-a)*(s-o)-(i-a)*(n-o)>=0}function y(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&m(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(b(e,t)&&b(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,s=(e.y+t.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||S(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function S(e,t){return e.x===t.x&&e.y===t.y}function m(e,t,r,n){var i=V(g(e,t,r)),s=V(g(e,t,n)),a=V(g(r,n,e)),o=V(g(r,n,t));return i!==s&&a!==o||!(0!==i||!_(e,r,t))||!(0!==s||!_(e,n,t))||!(0!==a||!_(r,e,n))||!(0!==o||!_(r,t,n))}function _(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function V(e){return e>0?1:e<0?-1:0}function b(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function L(e,t){var r=new z(e.i,e.x,e.y),n=new z(t.i,t.x,t.y),i=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function M(e,t,r,n){var i=new z(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function T(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function z(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(e,t,r,n){for(var i=0,s=t,a=r-n;s<r;s+=n)i+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return i}return e.deviation=function(e,t,r,n){var i=t&&t.length,s=Math.abs(E(e,0,i?t[0]*r:e.length,r));if(i)for(var a=0,o=t.length;a<o;a++)s-=Math.abs(E(e,t[a]*r,a<o-1?t[a+1]*r:e.length,r));var l=0;for(a=0;a<n.length;a+=3){var u=n[a]*r,v=n[a+1]*r,c=n[a+2]*r;l+=Math.abs((e[u]-e[c])*(e[v+1]-e[u+1])-(e[u]-e[v])*(e[c+1]-e[u+1]))}return 0===s&&0===l?0:Math.abs((l-s)/s)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var s=0;s<e[i].length;s++)for(var a=0;a<t;a++)r.vertices.push(e[i][s][a]);i>0&&r.holes.push(n+=e[i-1].length)}return r},e},void 0!==(s=i())&&(n.exports=s);var o=a.exports},62311:(e,t,r)=>{"use strict";r.d(t,{vX:()=>u,s5:()=>o,k3:()=>l,Or:()=>a});const n=128/Math.PI,i=1/Math.LN2;function s(e,t){return(e%=t)>=0?e:e+t}function a(e){return s(e*n,256)}function o(e){return s(.7111111111111111*e,256)}function l(e){return Math.log(e)*i}function u(e,t,r){return e>=t&&e<=r||e>=r&&e<=t}},79243:(e,t,r)=>{"use strict";r.d(t,{dk:()=>d,Gq:()=>y,a:()=>x,mE:()=>f,m2:()=>l,qr:()=>p,jj:()=>a,hF:()=>o});var n=r(2747),i=r(63054),s=r(90190);function a(e,t,r,n,s){switch(e){case i.LW.FILL:return d.from(t,n);case i.LW.LINE:return x.from(t,r);case i.LW.MARKER:return f.from(t);case i.LW.TEXT:return p.from(t);case i.LW.LABEL:return y.from(t,s);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${e}`)}}function o(e){switch(l.load(e).geometryType){case i.LW.MARKER:return new f(e);case i.LW.FILL:return new d(e);case i.LW.LINE:return new x(e);case i.LW.TEXT:return new p(e);case i.LW.LABEL:return new y(e)}}class l{constructor(e){this._data=0,this._data=e}static load(e){const t=this.shared;return t.data=e,t}set data(e){this._data=e}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(e){this.setBits(e,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(e){this.setBit(20,e)}get sdf(){return!!this.bit(11)}set sdf(e){this.setBit(11,e)}get pattern(){return!!this.bit(12)}set pattern(e){this.setBit(12,e)}get textureBinding(){return this.bits(0,8)}set textureBinding(e){this.setBits(e,0,8)}get geometryTypeString(){switch(this.geometryType){case i.LW.FILL:return"fill";case i.LW.MARKER:return"marker";case i.LW.LINE:return"line";case i.LW.TEXT:return"text";case i.LW.LABEL:return"label";default:throw new n.Z(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(e,t){const r=1<<e;t?this._data|=r:this._data&=~r}bit(e){return(this._data&1<<e)>>e}setBits(e,t,r){for(let n=t,i=0;n<r;n++,i++)this.setBit(n,0!=(e&1<<i))}bits(e,t){let r=0;for(let n=e,i=0;n<t;n++,i++)r|=this.bit(n)<<i;return r}hasVV(){return!1}setVV(e,t){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}getVariationHash(){return this._data&~(7&this.textureBinding)}}l.shared=new l(0);const u=e=>class extends e{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(e){this.setBit(16,e)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(e){this.setBit(17,e)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(e){this.setBit(18,e)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(e){this.setBit(19,e)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(e,t){super.setVV(e,t);const r=function(e,t=!1){const r=i.X.SIZE_FIELD_STOPS|i.X.SIZE_MINMAX_VALUE|i.X.SIZE_SCALE_STOPS|i.X.SIZE_UNIT_VALUE,n=(e&(i.mf.FIELD_TARGETS_OUTLINE|i.mf.MINMAX_TARGETS_OUTLINE|i.mf.SCALE_TARGETS_OUTLINE|i.mf.UNIT_TARGETS_OUTLINE))>>>4;return t?r&n:r&~n}(e,t)&e;this.vvSizeMinMaxValue=!!(r&i.X.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(r&i.X.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(r&i.X.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(r&i.X.SIZE_SCALE_STOPS)}},v=e=>class extends e{get vvRotation(){return 0!==this.bit(15)}set vvRotation(e){this.setBit(15,e)}hasVV(){return super.hasVV()||this.vvRotation}setVV(e,t){super.setVV(e,t),this.vvRotation=!t&&!!(e&i.X.ROTATION)}},c=e=>class extends e{get vvColor(){return 0!==this.bit(13)}set vvColor(e){this.setBit(13,e)}hasVV(){return super.hasVV()||this.vvColor}setVV(e,t){super.setVV(e,t),this.vvColor=!t&&!!(e&i.X.COLOR)}},h=e=>class extends e{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(e){this.setBit(14,e)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(e,t){super.setVV(e,t),this.vvOpacity=!t&&!!(e&i.X.OPACITY)}};class d extends(c(h(l))){static load(e){const t=this.shared;return t.data=e,t}static from(e,t){const r=this.load(0);return r.geometryType=i.LW.FILL,t?r.dotDensity=!0:r.setVV(e,!1),r.data}getVariation(){return{...super.getVariation(),dotDensity:this.dotDensity,vvColor:this.vvColor,vvOpacity:this.vvOpacity}}get dotDensity(){return!!this.bit(15)}set dotDensity(e){this.setBit(15,e)}}d.shared=new d(0);class f extends(c(h(v(u(l))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=i.LW.MARKER,t.setVV(e,!1),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}f.shared=new f(0);class x extends(c(h(u(l)))){static load(e){const t=this.shared;return t.data=e,t}static from(e,t){const r=this.load(0);return r.geometryType=i.LW.LINE,r.setVV(e,t),r.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}x.shared=new x(0);class p extends(c(h(v(u(l))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(e);return t.geometryType=i.LW.TEXT,t.setVV(e,!1),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}p.shared=new p(0);class y extends(u(l)){static load(e){const t=this.shared;return t.data=e,t}static from(e,t){const r=this.load(0);return r.geometryType=i.LW.LABEL,r.setVV(e,!1),r.mapAligned=(0,s.N)(t),r.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}y.shared=new y(0)},90190:(e,t,r)=>{"use strict";function n(e){switch(e){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}r.d(t,{N:()=>n})},28127:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b});var n=r(16304),i=r(8651),s=(r(2747),r(12131)),a=r(18419),o=r(54704),l=r(98154),u=(r(46942),r(47648),r(8680)),v=r(16678),c=r(2379),h=r(55613),d=r(81796),f=r(45858),x=r(80055),p=r(93765),y=r(57048),g=r(75990),S=r(90571);function m(e,t){return(!e.minScale||e.minScale>=t)&&(!e.maxScale||e.maxScale<=t)}function _(e){const t=e.message,r={message:{data:{},tileKey:t.tileKey,tileKeyOrigin:t.tileKeyOrigin},transferList:new Array};for(const n in t.data){const e=t.data[n];if(r.message.data[n]=null,(0,o.pC)(e)){const t=e.stride,i=e.indices.slice(0),s=e.vertices.slice(0),a=e.records.slice(0),l={stride:t,indices:i,vertices:s,records:a,metrics:(0,o.Po)(e.metrics,e=>e.slice(0))};r.transferList.push(i,s,a),r.message.data[n]=l}}return r}a.Z.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor");let V=class extends g.Z{constructor(){super(...arguments),this.type="symbol",this._matchers={feature:null,aggregate:null},this._bufferData=new Map,this._bufferIds=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}destroy(){}get supportsTileUpdates(){return!0}forEachBufferId(e){this._bufferIds.forEach(t=>{t.forEach(e)})}update(e,t){var r=this;return(0,n.Z)(function*(){const n=t.schema.processors[0];if("symbol"!==n.type)return;const i=(0,v.Hg)(r._schema,n);(0,v.uD)(i,"mesh")&&((0,s.Z)("esri-2d-update-debug")&&console.debug("Applying Update - Processor:",i),e.mesh=!0,e.why.mesh.push("Symbology changed"),r._schema=n,r._factory=r._createFactory(n),r._factory.update(n,r.tileStore.tileScheme.tileInfo))})()}onTileMessage(e,t,r,n){return(0,l.k_)(n),this._onTileData(e,t,r,n)}onTileClear(e){return this._bufferData.delete(e.key.id),this._bufferIds.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}onTileError(e,t,r){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},{signal:r.signal})}onTileUpdate(e){for(const t of e.removed)this._bufferData.has(t.key.id)&&this._bufferData.delete(t.key.id),this._bufferIds.has(t.key.id)&&this._bufferIds.delete(t.key.id);for(const t of e.added)this._bufferData.forEach(e=>{for(const r of e)r.message.tileKey===t.id&&this._updateTileMesh("append",t,_(r),[],!1,!1,null)})}_addBufferData(e,t){this._bufferData.has(e)||this._bufferData.set(e,[]),this._bufferData.get(e).push(_(t))}_createFactory(e){const{geometryType:t,objectIdField:r,fields:n}=this.service,i={geometryType:t,fields:n,spatialReference:c.Z.fromJSON(this.spatialReference)},s=new f.W((e,t)=>this.remoteClient.invoke("tileRenderer.getMaterialItems",e,t),this.tileStore.tileScheme.tileInfo),{matcher:a,aggregateMatcher:l}=e.mesh;return this._store=s,this._matchers.feature=(0,p.fL)(a,s,i),this._matchers.aggregate=(0,o.Po)(l,e=>(0,p.fL)(e,s,i)),new d.j(t,r,s)}_onTileData(e,t,r,i){var s=this;return(0,n.Z)(function*(){(0,l.k_)(i);const{type:n,addOrUpdate:a,remove:u}=t,v=t.end,c=!!s._schema.mesh.sortKey;if(!a)return s.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{type:n,addOrUpdate:null,remove:u,clear:!1,end:v,sort:c}},i);const h=s._processFeatures(e,a,r,i);try{const r=yield h;if((0,o.Wi)(r))return s.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{type:n,addOrUpdate:null,remove:u,clear:!1,end:v,sort:c}},i);const a=[];for(const t of r){let r=!1;const n=t.message.bufferIds,i=e.key.id,l=t.message.tileKey;if(i!==l&&(0,o.pC)(n)){if(!s.tileStore.get(l))continue;let e=s._bufferIds.get(l);e||(e=new Set,s._bufferIds.set(l,e));const t=Array.from(n);for(const n of t){if(e.has(n)){r=!0;break}e.add(n)}}r||(s._addBufferData(i,t),a.push(t))}yield(0,l.$6)(a.map(r=>{const a=e.key.id===r.message.tileKey;return s._updateTileMesh(n,e,r,a?t.remove:[],a&&t.end,t.clear,i.signal)}))}catch(d){s._handleError(e,d,i)}})()}_updateTileMesh(e,t,r,i,s,a,u){var v=this;return(0,n.Z)(function*(){const n=e,a=r.message.tileKey,c=!!v._schema.mesh.sortKey;a!==t.key.id&&(s=!1);const h=(0,o.Po)(r,e=>e.message),d=(0,o.Po)(r,e=>e.transferList)||[],f={type:n,addOrUpdate:h,remove:i,clear:!1,end:s,sort:c},x={transferList:(0,o.Wg)(d)||[],signal:u};return(0,l.k_)(x),v.remoteClient.invoke("tileRenderer.onTileData",{tileKey:a,data:f},x)})()}_processFeatures(e,t,r,i){var s=this;return(0,n.Z)(function*(){if((0,o.Wi)(t)||!t.hasFeatures)return null;const n={transform:e.transform,hasZ:!1,hasM:!1},a=s._factory,u={viewingMode:"",scale:e.scale},v=yield s._matchers.feature,c=yield s._matchers.aggregate;(0,l.k_)(i);const h=s._getLabelInfos(e,t);return yield a.analyze(t.getCursor(),v,c,n,u),(0,l.k_)(i),s._writeFeatureSet(e,t,n,h,a,r)})()}_writeFeatureSet(e,t,r,n,i,s){const a=t.getSize(),l=new h._(e.key.id,{features:a,records:a,metrics:0},"simple"===this._schema.mesh.matcher.type&&this._schema.mesh.matcher.isDotDensity,s,!0),u={viewingMode:"",scale:e.scale},v=t.getCursor();for(;v.next();)try{const t=v.getDisplayId(),s=(0,o.pC)(n)?n.get(t):null;i.writeCursor(l,v,r,u,e.level,s)}catch(c){}return l.serialize(e.tileInfoView.tileInfo.isWrappable)}_handleError(e,t,r){if(!(0,l.D_)(t))return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t.message},{signal:r.signal})}_getLabelingSchemaForScale(e){const t=this._schema.mesh.labels;if((0,o.Wi)(t))return null;if("subtype"===t.type){const r={type:"subtype",classes:{}};let n=!1;for(const i in t.classes){const s=t.classes[i].filter(t=>m(t,e.scale));n=n||!!s.length,r.classes[i]=s}return n?r:null}const r=t.classes.filter(t=>m(t,e.scale));return r.length?{type:"simple",classes:r}:null}_getLabels(e,t){if("subtype"===t.type){var r;const n=(0,o.s3)(this.service.subtypeField,"Expected to find subtype Field"),i=e.readAttribute(n);return null==i?[]:null!=(r=t.classes[i])?r:[]}return t.classes}_getLabelInfos(e,t){const r=this._getLabelingSchemaForScale(e);if((0,o.Wi)(r))return null;const n=new Map,i=t.getCursor();for(;i.next();){const e=i.getDisplayId(),t=[],s=(0,S.nE)(e),a=s&&1!==i.readAttribute("cluster_count")?"aggregate":"feature",o=this._getLabels(i,r);for(const r of o){if(r.target!==a)continue;const n=i.getStorage().getComputedStringAtIndex(s&&"feature"===a?i.readAttribute("referenceId"):e,r.fieldIndex);if(!n)continue;const o=(0,x.E)(n.toString()),l=o[1];this._store.getMosaicItem(r.symbol,(0,y._)(o[0])).then(e=>{t[r.index]={glyphs:e.glyphMosaicItems,rtl:l,index:r.index}})}n.set(e,t)}return n}};V=(0,i._)([(0,u.j)("esri.views.2d.layers.features.processors.SymbolProcessor")],V);var b=V}}]);